# yt-dlp

A configurable command-line tool using [yt-dlp](https://github.com/yt-dlp/yt-dlp) for deduplicating and tagging music.

Given a channel URL, yt-dlq will download the following as audio files, in order:

1. All videos in all playlists (albums) on the channel's _Releases_ tab
    - Each downloaded file will have its _Artist_ set as the uploader, its _Album_ set as the playlist title, and its _Album Artist_ set as the playlist's creator.
    - If a video is in multiple release playlists, it will be downloaded into all of them.
1. All videos in all playlists on the channels _Playlists_ tab
    - Each downloaded file will have its _Artist_ set as the uploader, its _Album_ set as the playlist title, and its _Album Artist_ set as the playlist's creator.
    - If a video is in multiple standard playlists, it will only be downloaded into the first one (unless `--playlist-duplicates` is passed on the CLI)
1. All other (public) videos uploaded by the channel.
    - A video will only be downloaded if it hasn't already been seen in a release or a standard playlist.
    - _Artist_ and _Album Artist_ will be set to the video uploader (i.e. channel). _Album_ will be set to the uploader prefixed with `--loose-videos-prefix` and suffixed with `--loose-videos-suffix`.

You can also provide URLs for a channel's playlists/releases/videos or individual playlists/videos.

Album art will also be embedded into each file.

Downloaded files will be organised into folders by album artist/channel, then album/playlist:
```
{Parent folder}
├{Channel}
│├{Release}
│├{Playlist}
│├{Playlist}
││├{Video}
││└{Video}
│└{Non-Playlist Video}
├{Channel}
```


## Installation
### Windows
```shell
python -m venv venv && .\venv\Scripts\activate
pip install -r requirements.txt
pip install -e .
```
### Linux
```shell
python -m venv venv && . ./venv/bin/activate
pip install -r requirements.txt
pip install -e .
```

## Usage
Simple usage providing a URL via command line:
```shell 
yt-dlq "https://www.youtube.com/watch?v=dQw4w9WgXcQ&pp=ygUJcmljayByb2xs"
```

You can also provide a text file with a list of URLs.
```
# batchfile.txt
https://www.youtube.com/watch?v=dQw4w9WgXcQ&pp=ygUJcmljayByb2xs # for each line, everything after any '#' is ignored
```
```shell
(venv) $ yt-dlq -a ./batchfile.txt
```

Type `yt-dlq --help` for a full description of command-line arguments:
```
(venv) $ yt-dlq --help
usage: yt-dlq [-h] [-c CONFIG_FILE] [-j FILE] [-a FILE] [-p] [-o FOLDER] [--ffmpeg-location PATH] [-b | -t | -n] [-g] [-d] [-f {mp3,m4a,mkv}] [-v] [-s JSON_FILE_PREFIX] [URL]

positional arguments:
  URL                   URL to download

options:
  -h, --help            show this help message and exit
  -c CONFIG_FILE, --config-file CONFIG_FILE
  -j FILE, --json-file FILE
                        File previously generated by this program containing URLs to download
  -a FILE, --batch-file FILE
                        File containing URLs to download, one URL per line. Lines starting with "#" are considered as comments and ignored
  -p, --permit-single   Allow releases with only one video to have their own folder. Otherwise, they will be downloaded to the `releases` subfolder.
  -o FOLDER, --output-dir FOLDER
                        Main folder to store downloaded videos and other info (default: data)
  --ffmpeg-location PATH
                        Location of the ffmpeg binary; either the path to the binary or its containing directory
  -b, --playlist-duplicates
                        Allow videos to be downloaded multiple times if they are in multiple playlists.
  -t, --text-placeholders
                        Create text file placeholders instead of duplicating videos in multiple playlists
  -n, --no-archives     Don't read or write any archive files (apart from those passed as arguments to the program)
  -g, --no-channels     Don't split downloads into folder by channel
  -d, --data-only       Only retrieve URLs; don't download videos
  -f {mp3,m4a,mkv}, --output-format {mp3,m4a,mkv}
                        Output audio file format
  -v, --verbose         Use downloader in verbose mode
  -s JSON_FILE_PREFIX, --json-file-prefix JSON_FILE_PREFIX
                        Prefix for output JSON file name.

Args that start with '--' can also be set in a config file (specified via -c). Config file syntax allows: key=value, flag=true, stuff=[a,b,c] (for details, see syntax at   
https://goo.gl/R74nmi). In general, command-line values override config file values which override defaults.
```
